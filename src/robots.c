#include "common.h"
#include "game.h"
#include "video.h"
#include "audio.h"

#define NOROBOT {0, 0, 0, 0, DoNothing, DoNothing, DoNothing, 0, 0, 0, 0, 0, 0}

typedef struct
{
    u8      x, y;
    int     min, max;
    EVENT   DoMove, DoDraw;
    EVENT   DoSpg;
    int     speed;
    int     gfx;
    u8      ink;
    int     nframes; // 3 or 7 = 4 frames or 8 frames
    int     frame;
    int     tile;
}
ROBOT;

static u16      robotSprite[29][8][16] =
{
    {
        {7968, 14816, 6624, 3872, 40704, 24448, 65472, 24064, 40896, 8064, 3584, 7936, 48032, 29120, 8320, 4352},
        {1988, 3708, 1660, 9156, 6080, 6112, 16368, 6128, 6128, 10208, 896, 896, 1728, 1728, 7280, 1728},
        {498, 926, 414, 242, 2544, 1528, 4092, 1504, 2556, 504, 224, 224, 224, 224, 224, 496},
        {125, 231, 103, 61, 124, 127, 1020, 120, 124, 127, 56, 56, 108, 108, 455, 108},
        {48640, 59136, 58880, 48128, 15872, 65024, 16320, 7680, 15872, 65024, 7168, 7168, 13824, 13824, 58240, 13824},
        {20352, 31168, 31104, 20224, 3984, 8096, 16368, 1952, 16272, 8064, 1792, 1792, 1792, 1792, 1792, 3968},
        {9184, 15984, 15968, 9156, 1000, 2024, 4092, 4072, 4072, 2020, 448, 448, 864, 864, 3640, 864},
        {1272, 1948, 1944, 1264, 249, 506, 1023, 122, 1017, 504, 112, 248, 1501, 910, 260, 136}
    },
    {
        {3072, 7680, 6912, 7872, 14592, 12800, 14848, 15616, 27904, 26880, 26880, 24832, 28928, 48640, 2048, 7680},
        {768, 1920, 1728, 1968, 3648, 3200, 3968, 3520, 6976, 6976, 5696, 6208, 7232, 12160, 1344, 3968},
        {192, 480, 432, 492, 912, 800, 928, 976, 1744, 1680, 1680, 1552, 1808, 3048, 592, 2016},
        {48, 120, 108, 123, 228, 200, 232, 244, 436, 404, 404, 388, 452, 760, 84, 248},
        {3072, 7680, 13824, 56832, 9984, 4864, 5888, 12032, 11648, 10624, 10624, 8576, 9088, 8000, 10752, 7936},
        {768, 1920, 3456, 14208, 2496, 1216, 1472, 3008, 2912, 2400, 2400, 2144, 2272, 6096, 2624, 2016},
        {192, 480, 864, 3552, 624, 304, 496, 944, 728, 728, 616, 536, 568, 500, 672, 496},
        {48, 120, 216, 888, 156, 76, 92, 188, 182, 150, 150, 134, 142, 125, 16, 120}
    },
    {
        {768, 1664, 1984, 768, 384, 192, 48832, 58240, 16640, 43776, 32512, 15872, 2048, 2048, 2048, 5120},
        {192, 416, 496, 192, 96, 48, 12208, 14560, 6336, 12480, 5568, 2688, 5376, 512, 1280, 0},
        {48, 104, 124, 48, 24, 12, 3052, 3640, 1040, 2736, 2032, 992, 128, 320, 0, 0},
        {12, 26, 31, 172, 342, 171, 859, 902, 268, 1020, 508, 248, 32, 32, 80, 0},
        {12288, 22528, 63488, 13568, 27264, 54528, 56000, 25024, 12416, 16320, 16256, 7936, 1024, 1024, 2560, 0},
        {3072, 5632, 15872, 3072, 6144, 12288, 14288, 7280, 2080, 3408, 4064, 1984, 256, 640, 0, 0},
        {768, 1408, 3968, 768, 1536, 3072, 3572, 1820, 792, 780, 936, 336, 168, 64, 160, 0},
        {192, 352, 992, 192, 384, 768, 893, 455, 130, 213, 254, 124, 16, 16, 16, 40}
    },
    {
        {1792, 2944, 5056, 5056, 5056, 2944, 1792, 256, 1792, 1280, 1792, 1920, 20352, 24512, 65216, 15424},
        {448, 736, 1488, 1488, 1488, 736, 448, 64, 448, 320, 448, 480, 9184, 12272, 32688, 7952},
        {112, 232, 484, 484, 484, 232, 112, 16, 112, 80, 112, 248, 8696, 10236, 32748, 4036},
        {28, 54, 99, 99, 99, 54, 28, 4, 28, 20, 28, 30, 1086, 1279, 4091, 1009},
        {14336, 27648, 50688, 50688, 50688, 27648, 14336, 8192, 14336, 10240, 14336, 30720, 31776, 65312, 57328, 36800},
        {3584, 5888, 10112, 10112, 10112, 5888, 3584, 2048, 3584, 2560, 3584, 7936, 8068, 16356, 14334, 9200},
        {896, 1856, 2976, 2976, 2976, 1856, 896, 512, 896, 640, 896, 1920, 1988, 4084, 3582, 2296},
        {224, 464, 968, 968, 968, 464, 224, 128, 224, 160, 224, 480, 498, 1018, 895, 572}
    },
    {
        {960, 4080, 8184, 8184, 12684, 3696, 28662, 44661, 45453, 40953, 39897, 35889, 18402, 576, 576, 3696}
    },
    {
        {49152, 49152, 49152, 49152, 49152, 49152, 49152, 57280, 57280, 65472, 8128, 3968, 30592, 65280, 57088, 57088},
        {12288, 12288, 12288, 12288, 12320, 12480, 13056, 13312, 14320, 16368, 2032, 992, 7648, 16320, 14272, 14272},
        {3072, 3072, 3104, 3136, 3136, 3200, 3200, 3328, 3580, 4092, 508, 248, 1912, 4080, 3568, 3568},
        {768, 768, 768, 768, 770, 780, 816, 832, 895, 1023, 127, 62, 478, 1020, 892, 892},
        {192, 192, 192, 192, 16576, 12480, 3264, 704, 65216, 65472, 65024, 31744, 31616, 16320, 16064, 16064},
        {48, 48, 1072, 560, 560, 304, 304, 176, 16304, 16368, 16256, 7936, 7904, 4080, 4016, 4016},
        {12, 12, 12, 12, 1036, 780, 204, 44, 4076, 4092, 4064, 1984, 1976, 1020, 1004, 1004},
        {3, 3, 3, 3, 3, 3, 3, 1019, 1019, 1023, 1016, 496, 494, 255, 251, 251}
    },
    {
        {7936, 32704, 29664, 62336, 65024, 63488, 65024, 65408, 32736, 32704, 7936, 2560, 2560, 2560, 2560, 7936},
        {1984, 8176, 7792, 15992, 16376, 15872, 16376, 16376, 8176, 8176, 1984, 640, 640, 1984, 0, 0},
        {496, 2044, 1854, 3896, 4064, 3968, 4064, 4088, 2046, 2044, 496, 496, 0, 0, 0, 0},
        {124, 463, 462, 1020, 1008, 992, 1008, 1020, 510, 511, 124, 40, 40, 124, 0, 0},
        {15872, 62336, 29568, 16320, 4032, 1984, 4032, 16320, 32640, 65408, 15872, 5120, 5120, 15872, 0, 0},
        {3968, 16352, 31968, 7408, 2032, 496, 2032, 8176, 32736, 16352, 3968, 3968, 0, 0, 0, 0},
        {992, 4088, 3704, 7804, 8188, 124, 8188, 8188, 4088, 4088, 992, 320, 320, 992, 0, 0},
        {248, 1022, 1998, 463, 127, 31, 127, 511, 2046, 1022, 248, 80, 80, 80, 80, 248}
    },
    {
        {6144, 7168, 2688, 3968, 3072, 7168, 7680, 7424, 15360, 15872, 15872, 28160, 17408, 16896, 33024, 0},
        {0, 0, 1536, 1792, 672, 992, 896, 1792, 1920, 1856, 3840, 3968, 3968, 7040, 13056, 16576},
        {0, 0, 0, 0, 384, 448, 168, 248, 224, 448, 480, 464, 960, 992, 2016, 16120},
        {0, 0, 96, 112, 42, 62, 56, 112, 120, 116, 240, 248, 504, 432, 780, 1024},
        {0, 0, 1536, 3584, 21504, 31744, 7168, 3584, 7680, 11776, 3840, 7936, 8064, 3456, 12480, 32},
        {0, 0, 0, 0, 384, 896, 5376, 7936, 1792, 896, 1920, 2944, 960, 1984, 2016, 8060},
        {0, 0, 96, 224, 1344, 1984, 448, 224, 480, 736, 240, 496, 496, 472, 204, 770},
        {24, 56, 336, 496, 48, 56, 120, 184, 60, 124, 124, 118, 34, 66, 129, 0}
    },
    {
        {5064, 7608, 4080, 1632, 1440, 576, 2016, 4080, 8184, 13260, 25542, 18018, 11316, 1632, 576, 3696},
        {3024, 3504, 4080, 1632, 1440, 576, 960, 8184, 32766, 59367, 33729, 51171, 1632, 3120, 2064, 14364},
        {7224, 1632, 3120, 26214, 9156, 26598, 14316, 8184, 4080, 2016, 576, 1440, 1632, 4080, 3504, 3024},
        {28686, 6168, 3120, 1632, 25542, 10212, 26598, 14316, 8184, 4080, 576, 1440, 5736, 4080, 3504, 960}
    },
    {
        {2048, 1280, 2176, 9472, 18560, 8448, 19456, 13056, 17536, 17536, 34880, 33856, 18560, 18560, 13056, 3072},
        {512, 4384, 2624, 4384, 2624, 4128, 768, 3264, 4128, 4192, 8848, 9488, 6176, 4128, 3264, 768},
        {64, 544, 1096, 548, 1096, 516, 200, 816, 1032, 1032, 2884, 2228, 1032, 1032, 816, 192},
        {68, 290, 580, 290, 580, 258, 560, 204, 322, 290, 529, 545, 274, 266, 204, 48}
    },
    {
        {2592, 5736, 336, 14690, 26062, 976, 65518, 34801, 30692, 51199, 35825, 12972, 25766, 18850, 4752, 13976},
        {0, 1312, 832, 12660, 7628, 976, 16364, 2036, 16352, 26620, 3058, 12972, 9380, 2960, 6872, 192},
        {0, 0, 544, 2400, 1480, 976, 8160, 2040, 8160, 6136, 4080, 4776, 1440, 2736, 192, 0},
        {0, 1312, 832, 12660, 7628, 976, 16364, 2036, 16352, 26620, 3058, 12972, 9380, 2960, 6872, 192}
    },
    {
        {3072, 3072, 3072, 3072, 3072, 3072, 3072, 3072, 3072, 3072, 65472, 3072, 24960, 53952, 45888, 24960},
        {768, 768, 768, 768, 768, 768, 768, 768, 768, 768, 16368, 768, 6240, 9424, 15568, 6240},
        {192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 4092, 192, 1560, 2868, 3372, 1560},
        {48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 1023, 48, 390, 589, 973, 390}
    },
    {
        {28672, 20480, 31744, 13312, 15872, 15872, 6144, 15360, 32256, 32256, 63232, 64256, 15360, 30208, 28160, 30464},
        {7168, 5120, 7936, 3328, 3968, 3968, 1536, 3840, 7040, 7040, 7040, 7552, 3840, 1536, 1536, 1792},
        {1792, 1280, 1984, 832, 992, 992, 384, 960, 2016, 2016, 3952, 4016, 960, 1888, 1760, 1904},
        {448, 320, 496, 208, 248, 248, 96, 240, 504, 1020, 2046, 1782, 248, 474, 782, 900},
        {896, 1664, 3968, 2816, 7936, 7936, 1536, 3840, 8064, 16320, 32736, 28512, 7936, 23424, 28864, 8640},
        {224, 416, 992, 704, 1984, 1984, 384, 960, 2016, 2016, 3824, 3568, 960, 1760, 1888, 3808},
        {56, 104, 248, 176, 496, 496, 96, 240, 504, 472, 472, 440, 240, 96, 96, 224},
        {14, 26, 62, 44, 124, 124, 24, 60, 126, 126, 239, 223, 60, 110, 118, 238}
    },
    {
        {0, 0, 16380, 25542, 60375, 59415, 4080, 2016, 3120, 3024, 7128, 7224, 16380, 16380, 16380, 16380},
        {15360, 32704, 32760, 25542, 2135, 2071, 4087, 2016, 3120, 3024, 7128, 7224, 16380, 16380, 16380, 16380},
        {0, 0, 16380, 25542, 60375, 59415, 4080, 2016, 3120, 3024, 7128, 7224, 16380, 16380, 16380, 16380},
        {60, 1022, 8190, 25542, 59920, 59408, 61424, 2016, 3120, 3024, 7128, 7224, 16380, 16380, 16380, 16380}
    },
    {
        {3072, 5632, 11520, 19584, 35904, 35904, 19584, 11520, 5632, 3072, 14080, 19456, 32704, 65472, 16512, 11776},
        {768, 768, 1408, 1920, 2880, 2880, 1920, 1408, 768, 768, 3776, 800, 16352, 16368, 4128, 1856},
        {192, 192, 192, 192, 128, 128, 192, 192, 192, 192, 464, 1224, 4092, 4088, 8, 944},
        {48, 104, 180, 180, 306, 306, 180, 180, 104, 48, 184, 306, 1023, 511, 256, 220}
    },
    {
        {0, 0, 0, 960, 3120, 4104, 8196, 16386, 32769, 16386, 8196, 53259, 11316, 19410, 4680, 576},
        {0, 0, 0, 960, 3120, 4104, 8196, 16386, 63519, 22506, 11220, 4680, 3120, 960, 0, 0},
        {1056, 1056, 4680, 19410, 11316, 37833, 42981, 18018, 34401, 18402, 9156, 4104, 3120, 960, 0, 0},
        {0, 0, 0, 960, 3120, 4680, 10836, 24570, 63103, 18402, 9156, 4104, 3120, 960, 0, 0}
    },
    {
        {24960, 45632, 46016, 24960, 3072, 65472, 21120, 4608, 4608, 7680, 3072, 3072, 3072, 3072, 7680, 16128},
        {6240, 9424, 15568, 6240, 768, 16368, 5280, 1152, 1152, 1920, 768, 768, 1920, 4032, 0, 0},
        {1560, 3388, 3364, 1560, 192, 4092, 1320, 288, 288, 480, 480, 1008, 0, 0, 0, 0},
        {390, 971, 587, 390, 48, 1023, 330, 72, 72, 120, 48, 48, 120, 252, 0, 0}
    },
    {
        {960, 65535, 43989, 65535, 5064, 10644, 5544, 3024, 1440, 960, 960, 1440, 2640, 5160, 10260, 4104},
        {0, 0, 960, 65535, 43989, 65535, 5064, 10644, 5544, 3024, 1440, 960, 960, 9632, 19028, 5162},
        {0, 0, 0, 7, 1021, 65495, 44024, 65472, 960, 384, 5540, 19410, 1444, 9154, 3024, 9640},
        {0, 0, 0, 32, 514, 21, 974, 4052, 52168, 47042, 58312, 12673, 2020, 50120, 6082, 9212},
        {0, 256, 0, 2080, 0, 0, 8450, 17, 906, 3728, 19392, 14082, 25280, 12545, 1506, 49988},
        {0, 0, 0, 0, 0, 512, 0, 32, 4104, 2692, 32, 25856, 8808, 2208, 976, 6112},
        {0, 0, 0, 0, 0, 0, 0, 0, 512, 32, 4096, 0, 1296, 104, 8864, 3536},
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128, 32, 2048, 704, 1888}
    },
    {
        {24966, 40953, 40953, 24966, 960, 65535, 32769, 43689, 40957, 46425, 36877, 46425, 40957, 43689, 32769, 65535},
        {7608, 8948, 8948, 7608, 960, 65535, 54613, 49151, 60077, 45063, 58701, 45063, 60077, 49151, 54613, 65535},
        {2016, 2064, 2064, 2016, 960, 65535, 65535, 54615, 57347, 51879, 59379, 51879, 57347, 54615, 65535, 65535},
        {7608, 12100, 12100, 7608, 960, 65535, 43691, 49153, 38227, 53241, 39603, 53241, 38227, 49153, 43691, 65535}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65472, 33216, 65472, 33344, 65088, 65472},
        {0, 0, 0, 0, 0, 0, 16368, 8304, 16368, 8336, 16272, 16368, 0, 0, 0, 0},
        {0, 0, 0, 0, 4092, 2076, 4092, 2084, 4068, 4092, 0, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0, 0, 1023, 519, 1023, 521, 1017, 1023, 0, 0, 0, 0}
    },
    {
        {0, 2048, 5120, 10752, 21760, 18944, 33792, 32960, 32960, 16640, 32640, 16320, 8064, 3840, 2688, 4672},
        {10752, 5376, 10752, 5376, 8192, 8192, 8192, 8240, 8240, 4160, 8160, 4080, 2016, 960, 672, 1168},
        {0, 4096, 10240, 21504, 43520, 20736, 8448, 268, 524, 528, 1016, 1020, 504, 240, 168, 292},
        {1344, 2688, 1344, 2688, 64, 64, 64, 67, 131, 132, 254, 255, 126, 60, 42, 73},
        {672, 336, 672, 336, 512, 512, 512, 49664, 49408, 8448, 32512, 65280, 32256, 15360, 21504, 37376},
        {0, 8, 20, 42, 85, 138, 132, 12416, 12352, 2112, 8128, 16320, 8064, 3840, 5376, 9344},
        {84, 168, 84, 168, 4, 4, 4, 3076, 3076, 520, 2040, 4080, 2016, 960, 1344, 2336},
        {0, 16, 40, 84, 170, 82, 33, 769, 769, 130, 510, 1020, 504, 240, 336, 584}
    },
    {
        {32256, 39168, 65280, 56064, 59136, 32256, 9216, 9216, 9216, 16896, 16896, 16896, 33024, 33024, 49920, 49920},
        {0, 8064, 9792, 16320, 14016, 14784, 8064, 4224, 8256, 8256, 16416, 16416, 32784, 32816, 49200, 49152},
        {0, 0, 0, 2016, 2448, 4080, 3504, 3696, 2016, 2064, 4104, 8196, 16386, 32769, 49155, 49155},
        {0, 504, 612, 1020, 876, 924, 504, 264, 516, 516, 1026, 1026, 2049, 3073, 3075, 3}
    },
    {
        {832, 3952, 16188, 16204, 24422, 24438, 40831, 127, 36352, 36607, 18174, 16626, 8196, 12300, 3120, 704},
        {960, 4080, 16300, 16332, 24518, 18358, 39359, 40575, 36479, 36255, 17894, 16882, 8196, 12300, 3120, 960},
        {960, 4080, 12220, 14280, 23526, 24038, 40671, 40511, 35967, 35711, 18366, 16834, 4, 12292, 3120, 960},
        {960, 3056, 15804, 15820, 24038, 24308, 40675, 40479, 34943, 34687, 1918, 16818, 8196, 12300, 3088, 960}
    },
    {
        {1536, 3072, 6144, 14336, 29696, 51840, 34240, 960, 1600, 52928, 55360, 65472, 57856, 51328, 54592, 2176},
        {384, 768, 1536, 3584, 7424, 12960, 8560, 240, 400, 25520, 26128, 32752, 30848, 25120, 25936, 544},
        {96, 192, 384, 896, 1856, 3240, 2140, 60, 100, 12524, 12676, 16380, 15904, 12424, 12628, 136},
        {24, 48, 96, 224, 464, 810, 535, 15, 25, 1595, 1633, 2047, 1928, 1570, 1621, 34}
    },
    {
        {4608, 3072, 7680, 48960, 29568, 29568, 48960, 24192, 19584, 21120, 32640, 3072, 24960, 37568, 45632, 24960},
        {768, 1920, 1920, 7392, 15216, 15216, 7392, 6048, 6048, 4896, 8160, 768, 6240, 9360, 13488, 6240},
        {480, 480, 288, 3804, 3564, 3564, 3804, 1320, 1512, 1512, 2040, 192, 1560, 3364, 2356, 1560},
        {120, 72, 48, 891, 765, 765, 891, 306, 330, 378, 510, 48, 390, 717, 585, 390}
    },
    {
        {14, 51, 197, 793, 3173, 12701, 50813, 39325, 50717, 61853, 31869, 7965, 2013, 509, 127, 28},
        {960, 1856, 1568, 3744, 3216, 7504, 6472, 15016, 12964, 29780, 25682, 65514, 65513, 65525, 16387, 32766},
        {14336, 65024, 49024, 48096, 47352, 48702, 47503, 47203, 47513, 48739, 47500, 42544, 39104, 41728, 52224, 28672},
        {32766, 49154, 45055, 38911, 22527, 18982, 10798, 9548, 5468, 4760, 2744, 2352, 1392, 1120, 736, 960}
    },
    {
        {0, 3120, 576, 384, 2016, 28662, 6552, 2640, 63903, 7800, 7224, 31790, 39897, 3248, 2016, 384},
        {0, 0, 3696, 16770, 10212, 8184, 36849, 31326, 6552, 7800, 64575, 5160, 8152, 3184, 2016, 384},
        {0, 3120, 576, 384, 2016, 20466, 16380, 3696, 55707, 15996, 7224, 13356, 56315, 3632, 2016, 384},
        {1056, 1056, 576, 384, 2016, 4080, 32766, 2641, 6552, 32382, 39993, 5176, 15324, 19762, 18402, 384}
    }
};

static void DoRobotLeft(void);
static void DoRobotRight(void);
static void DoRobotUp(void);
static void DoRobotDown(void);
static void DoRobotKong(void);
static void DoRobotSkylab(void);
static void DoRobotDraw(void);
static void DoRobotSpg(void);

static ROBOT    robotStart[20][8] =
{
    {
        {8, 7, 64, 120, DoRobotRight, DoRobotDraw, DoNothing, 0, 0, 0x6, 7, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {18, 3, 8, 144, DoRobotLeft, DoRobotDraw, DoNothing, 0, 1, 0x7, 7, 7, 0},
        {29, 13, 96, 232, DoRobotLeft, DoRobotDraw, DoNothing, 0, 1, 0x7, 7, 7, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {19, 13, 8, 152, DoRobotLeft, DoRobotDraw, DoNothing, 0, 2, 0x3, 7, 7, 0},
        {16, 3, 8, 128, DoRobotLeft, DoRobotDraw, DoNothing, 0, 2, 0x5, 7, 7, 0},
        {18, 3, 144, 232, DoRobotRight, DoRobotDraw, DoNothing, 0, 2, 0xe, 7, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {1, 13, 8, 80, DoRobotRight, DoRobotDraw, DoNothing, 0, 3, 0x5, 7, 0, 0},
        {7, 13, 48, 120, DoRobotRight, DoRobotDraw, DoNothing, 0, 3, 0x8, 7, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {12, 3, 8, 96, DoRobotLeft, DoRobotDraw, DoNothing, 0, 5, 0x6, 7, 7, 0},
        {4, 7, 32, 96, DoRobotRight, DoRobotDraw, DoNothing, 0, 5, 0x0, 7, 0, 0},
        {15, 0, 0, 88, DoRobotDown, DoRobotDraw, DoNothing, 1, 4, 0x7, 0, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {6, 8, 48, 104, DoRobotRight, DoRobotDraw, DoNothing, 0, 6, 0xe, 7, 0, 0},
        {14, 8, 112, 168, DoRobotRight, DoRobotDraw, DoNothing, 0, 6, 0x3, 7, 1, 0},
        {8, 13, 64, 160, DoRobotRight, DoRobotDraw, DoNothing, 0, 6, 0x5, 7, 2, 0},
        {24, 13, 192, 232, DoRobotRight, DoRobotDraw, DoNothing, 0, 6, 0x2, 7, 3, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {15, 1, 120, 232, DoRobotRight, DoRobotDraw, DoNothing, 0, 7, 0x7, 7, 0, 0},
        {10, 8, 16, 80, DoRobotLeft, DoRobotDraw, DoNothing, 0, 7, 0x2, 7, 7, 0},
        {17, 13, 136, 232, DoRobotRight, DoRobotDraw, DoNothing, 0, 7, 0xe, 7, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {15, 0, 0, 100, DoRobotKong, DoRobotDraw, DoNothing, 4, 8, 0xe, 1, 0, 0},
        {9, 13, 8, 72, DoRobotLeft, DoRobotDraw, DoNothing, 0, 9, 0x2, 3, 7, 0},
        {11, 11, 88, 120, DoRobotRight, DoRobotDraw, DoNothing, 1, 9, 0xe, 3, 0, 0},
        {18, 7, 144, 168, DoRobotRight, DoRobotDraw, DoNothing, 0, 9, 0x6, 3, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {12, 3, 96, 144, DoRobotRight, DoRobotDraw, DoNothing, 0, 11, 0xa, 3, 0, 0},
        {16, 10, 96, 144, DoRobotRight, DoRobotDraw, DoNothing, 1, 11, 0x6, 3, 0, 0},
        {5, 1, 5, 100, DoRobotDown, DoRobotDraw, DoNothing, 1, 10, 0x3, 3, 0, 0},
        {10, 1, 5, 100, DoRobotDown, DoRobotDraw, DoNothing, 2, 10, 0x4, 3, 1, 0},
        {20, 1, 5, 100, DoRobotDown, DoRobotDraw, DoNothing, 1, 10, 0x1, 3, 2, 0},
        {25, 1, 5, 100, DoRobotDown, DoRobotDraw, DoNothing, 2, 10, 0x2, 3, 3, 0},
        NOROBOT, NOROBOT
    },
    {
        {9, 7, 72, 112, DoRobotRight, DoRobotDraw, DoNothing, 0, 12, 0xb, 7, 0, 0},
        {12, 10, 64, 112, DoRobotRight, DoRobotDraw, DoNothing, 1, 12, 0xe, 7, 0, 0},
        {8, 13, 32, 208, DoRobotRight, DoRobotDraw, DoNothing, 0, 12, 0x6, 7, 0, 0},
        {18, 5, 136, 168, DoRobotRight, DoRobotDraw, DoNothing, 0, 12, 0xf, 7, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {15, 3, 120, 192, DoRobotRight, DoRobotDraw, DoNothing, 0, 14, 0xe, 3, 0, 0},
        {14, 7, 112, 144, DoRobotRight, DoRobotDraw, DoNothing, 1, 14, 0xc, 3, 0, 0},
        {15, 13, 40, 152, DoRobotLeft, DoRobotDraw, DoNothing, 0, 14, 0xa, 3, 7, 0},
        {12, 1, 2, 56, DoRobotDown, DoRobotDraw, DoNothing, 2, 13, 0x3, 3, 0, 0},
        {3, 4, 32, 100, DoRobotDown, DoRobotDraw, DoNothing, 1, 13, 0x4, 3, 1, 0},
        {21, 6, 48, 100, DoRobotDown, DoRobotDraw, DoNothing, 1, 13, 0x6, 3, 2, 0},
        {26, 6, 4, 100, DoRobotUp, DoRobotDraw, DoNothing, 3, 13, 0x2, 3, 3, 0},
        NOROBOT
    },
    {
        {15, 0, 0, 100, DoRobotKong, DoRobotDraw, DoNothing, 4, 8, 0xe, 1, 0, 0},
        {9, 13, 8, 72, DoRobotLeft, DoRobotDraw, DoNothing, 0, 9, 0x6, 3, 7, 0},
        {11, 11, 88, 120, DoRobotRight, DoRobotDraw, DoNothing, 1, 9, 0x2, 3, 0, 0},
        {25, 6, 200, 224, DoRobotRight, DoRobotDraw, DoNothing, 0, 9, 0x3, 3, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {7, 1, 56, 232, DoRobotRight, DoRobotDraw, DoNothing, 0, 16, 0x3, 3, 0, 0},
        {16, 4, 56, 232, DoRobotRight, DoRobotDraw, DoNothing, 1, 16, 0xc, 3, 0, 0},
        {20, 7, 80, 208, DoRobotLeft, DoRobotDraw, DoNothing, 0, 16, 0x6, 3, 7, 0},
        {18, 10, 56, 232, DoRobotRight, DoRobotDraw, DoNothing, 1, 16, 0x2, 3, 0, 0},
        {5, 1, 8, 100, DoRobotDown, DoRobotDraw, DoNothing, 2, 15, 0x7, 3, 0, 0},
        NOROBOT, NOROBOT, NOROBOT
    },
    {
        {1, 0, 0, 72, DoRobotSkylab, DoRobotDraw, DoNothing, 4, 17, 0xa, 7, 0, 0},
        {11, 0, 0, 32, DoRobotSkylab, DoRobotDraw, DoNothing, 1, 17, 0x5, 7, 0, 0},
        {21, 2, 2, 56, DoRobotSkylab, DoRobotDraw, DoNothing, 3, 17, 0xc, 7, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {17, 13, 136, 152, DoRobotRight, DoRobotDraw, DoNothing, 0, 19, 0x7, 3, 0, 0},
        {9, 5, 36, 102, DoRobotDown, DoRobotDraw, DoNothing, 2, 18, 0xc, 3, 0, 0},
        {15, 8, 36, 102, DoRobotDown, DoRobotDraw, DoNothing, 1, 18, 0xa, 3, 1, 0},
        {21, 10, 32, 104, DoRobotUp, DoRobotDraw, DoNothing, 3, 18, 0x6, 3, 2, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {9, 13, 8, 144, DoRobotRight, DoRobotDraw, DoNothing, 0, 20, 0xc, 7, 0, 0},
        {1, 10, 8, 56, DoRobotRight, DoRobotDraw, DoNothing, 0, 20, 0x6, 7, 0, 0},
        {18, 7, 144, 184, DoRobotRight, DoRobotDraw, DoNothing, 0, 20, 0x3, 7, 0, 0},
        {26, 5, 200, 232, DoRobotRight, DoRobotDraw, DoNothing, 1, 20, 0x5, 7, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT
    },
    {
        {5, 13, 40, 64, DoRobotRight, DoRobotDraw, DoNothing, 1, 21, 0x9, 3, 0, 0},
        {12, 13, 96, 200, DoRobotRight, DoRobotDraw, DoNothing, 0, 21, 0xe, 3, 0, 0},
        {3, 8, 64, 102, DoRobotDown, DoRobotDraw, DoNothing, 2, 25, 0x6, 3, 0, 0},
        {10, 8, 3, 96, DoRobotUp, DoRobotDraw, DoNothing, 3, 25, 0x3, 3, 1, 0},
        {19, 6, 0, 64, DoRobotDown, DoRobotDraw, DoNothing, 1, 25, 0x7, 3, 2, 0},
        {27, 0, 4, 96, DoRobotDown, DoRobotDraw, DoNothing, 4, 25, 0x1, 3, 3, 0},
        NOROBOT, NOROBOT
    },
    {
        {12, 3, 96, 144, DoRobotRight, DoRobotDraw, DoNothing, 1, 11, 0x4, 3, 0, 0},
        {16, 10, 96, 136, DoRobotRight, DoRobotDraw, DoNothing, 1, 11, 0x5, 3, 0, 0},
        {16, 6, 96, 136, DoRobotRight, DoRobotDraw, DoNothing, 0, 11, 0x3, 3, 0, 0},
        {16, 13, 96, 144, DoRobotLeft, DoRobotDraw, DoNothing, 0, 11, 0x6, 3, 7, 0},
        {5, 1, 5, 104, DoRobotDown, DoRobotDraw, DoNothing, 3, 26, 0x7, 3, 0, 0},
        {10, 1, 5, 104, DoRobotDown, DoRobotDraw, DoNothing, 2, 26, 0xc, 3, 1, 0},
        {20, 1, 5, 104, DoRobotDown, DoRobotDraw, DoNothing, 4, 26, 0x9, 3, 2, 0},
        {25, 1, 5, 104, DoRobotDown, DoRobotDraw, DoNothing, 1, 26, 0xe, 3, 3, 0}
    },
    {
        {24, 3, 184, 232, DoRobotRight, DoRobotDraw, DoRobotSpg, 0, 23, 0x8, 3, 0, 0},
        {28, 6, 176, 232, DoRobotRight, DoRobotDraw, DoRobotSpg, 0, 23, 0x5, 3, 0, 0},
        {29, 9, 184, 232, DoRobotLeft, DoRobotDraw, DoRobotSpg, 1, 23, 0x9, 3, 7, 0},
        {16, 13, 104, 232, DoRobotRight, DoRobotDraw, DoRobotSpg, 0, 23, 0x1, 3, 0, 0},
        {5, 8, 2, 102, DoRobotDown, DoRobotDraw, DoRobotSpg, 3, 22, 0x9, 3, 0, 0},
        {11, 7, 48, 102, DoRobotUp, DoRobotDraw, DoRobotSpg, 2, 22, 0x1, 3, 1, 0},
        {16, 10, 4, 80, DoRobotDown, DoRobotDraw, DoRobotSpg, 1, 22, 0x8, 3, 2, 0},
        NOROBOT
    },
    {
        {7, 13, 56, 176, DoRobotRight, DoRobotDraw, DoNothing, 0, 24, 0x6, 3, 0, 0},
        {24, 6, 40, 103, DoRobotDown, DoRobotDraw, DoNothing, 1, 15, 0x7, 3, 0, 0},
        NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT, NOROBOT
    }
};

static int      robotAlign[8] = {4, 6, 6, 6, 6, 6, 6, 6};

static ROBOT    robotThis[8], *curRobot;

void DoRobotSpg(void)
{
    int     count;
    int     tile = curRobot->tile, adj = 1;

    for (count = 0; count < robotAlign[curRobot->y & 7]; count++, tile += adj, adj ^= 30)
    {
        Level_SetSpgTile(tile, B_ROBOT);
    }
}

void Robots_Barrel()
{
    robotThis[2].max = 18 * 8;
}

static void DoRobotLeft()
{
    if (gameTicks & curRobot->speed)
    {
        return;
    }

    if (curRobot->frame-- > 4)
    {
        return;
    }

    if (curRobot->x > curRobot->min)
    {
        curRobot->x -= 8;
        curRobot->tile--;
        curRobot->frame = 7;
        return;
    }
    curRobot->DoMove = DoRobotRight;
    curRobot->frame = 0;
}

static void DoRobotRight()
{
    if (gameTicks & curRobot->speed)
    {
        return;
    }

    if (curRobot->frame++ < 3)
    {
        return;
    }

    if (curRobot->x < curRobot->max)
    {
        curRobot->x += 8;
        curRobot->tile++;
        curRobot->frame = 0;
        return;
    }
    curRobot->DoMove = DoRobotLeft;
    curRobot->frame = 7;
}

static void DoRobotUp()
{
    int     pos = curRobot->y - curRobot->speed;

    if (pos < curRobot->min)
    {
        curRobot->DoMove = DoRobotDown;
    }
    else
    {
        if ((pos & 120) < (curRobot->y & 120))
        {
            curRobot->tile -= 32;
        }

        curRobot->y = pos;
    }

    curRobot->frame++;
}

static void DoRobotDown()
{
    int     pos = curRobot->y + curRobot->speed;

    if (pos < curRobot->max)
    {
        if ((pos & 120) > (curRobot->y & 120))
        {
            curRobot->tile += 32;
        }

        curRobot->y = pos;
    }
    else
    {
        curRobot->DoMove = DoRobotUp;
    }

    curRobot->frame++;
}

static void DoRobotKong()
{
    robotThis[0].frame &= 2;
    robotThis[0].frame |= ((gameTicks >> 3) & 1);
}

static void DoRobotFall()
{
    if (curRobot->y == curRobot->max)
    {
        curRobot->DoMove = DoNothing;
        curRobot->DoDraw = DoNothing;
    }
    else
    {
        curRobot->y += curRobot->speed;
        DoRobotKong();
        Game_ScoreAdd(100);
    }
}

void Robots_Kong()
{
    robotThis[0].frame |= 2;
    robotThis[0].nframes |= 2;
    robotThis[0].ink = 0xf;
    robotThis[0].DoMove = DoRobotFall;

    Audio_Sfx(SFX_KONG);
}

static void DoRobotEugene()
{
    if (curRobot->y < curRobot->max)
    {
        curRobot->y += curRobot->speed;
    }

    curRobot->ink = (curRobot->ink - 1) & 0x7;
}

void Robots_Eugene()
{
    robotThis[2].DoMove = DoRobotEugene;
}

static void DoRobotSkylab()
{
    if (curRobot->y < curRobot->max)
    {
        curRobot->y += curRobot->speed;
    }
    else if (++curRobot->frame == 8)
    {
        curRobot->frame = 0;
        curRobot->x += 64;
        curRobot->y = curRobot->min;
    }
}

void Robots_Ticker()
{
    int count;

    curRobot = &robotThis[0];

    for (count = 0; count < 8; count++, curRobot++)
    {
        curRobot->DoMove();
        curRobot->DoSpg();
    }
}

static void DoRobotDraw()
{
    Video_SpriteBlend((curRobot->y << 8) | curRobot->x, robotSprite[curRobot->gfx][curRobot->frame & curRobot->nframes], curRobot->ink);
}

void Robots_Drawer()
{
    int count;

    curRobot = &robotThis[0];

    for (count = 0; count < 8; count++, curRobot++)
    {
        curRobot->DoDraw();
    }
}

void Robots_Init()
{
    int     count;
    ROBOT   *robot = &robotThis[0], *start = &robotStart[gameLevel][0];

    for (count = 0; count < 8; count++, robot++, start++)
    {
        robot->DoMove = start->DoMove;
        robot->DoDraw = start->DoDraw;
        robot->DoSpg = start->DoSpg;
        robot->x = start->x * 8;
        if (gameLevel == SKYLAB)
        {
            robot->y = start->min;
        }
        else
        {
            robot->y = start->y * 8;
            if (gameLevel == SPG)
            {
                robot->tile = start->y * 32 + start->x;
            }
        }

        robot->min = start->min;
        robot->max = start->max;

        robot->speed = start->speed;
        robot->gfx = start->gfx;
        robot->ink = start->ink;
        robot->nframes = start->nframes;
        robot->frame = start->frame;
    }
}
